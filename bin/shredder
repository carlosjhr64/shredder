#!/usr/bin/env ruby

# Gems:
require 'help_parser'

# This Gem:
require 'shredder'
include SHREDDER

NAME = File.basename $0 # Program Name
HELP = <<HELP
Usage: #{NAME} [options] [file] shred1 shred2...
Options:
  -r --shred     shred a file to shreds
  -w --sew       sew shreds back to file
  -s --stream    shreds/sews from/to stdin/stdout respectively
  --relay        relay first stdin gets to stdout puts

  -h --help      Puts this help and exits
  -v --version   Puts version and exits
Note:
  Typical use of relay is for passphrase.
Version: #{VERSION}
HELP

begin
  OPTIONS = HELP_PARSER::HelpParser.new(VERSION, HELP)
  OPTIONS.defaults!(:shred, false, true)
  OPTIONS.defaults!(:sew,   false, true)
  OPTIONS.usage_error "Need choice: sew or shred?" unless OPTIONS[:sew] ^ OPTIONS[:shred] # xor
  MIN = (OPTIONS[:stream])? 2 : 3
  OPTIONS.usage_error "Need at least 2 shreds" unless ARGV.length >= MIN
  Shredder.new(OPTIONS, ARGV).execute
rescue HELP_PARSER::UsageException
  puts $!.message
rescue HELP_PARSER::UsageError
  puts $!.message
  exit 64
end
